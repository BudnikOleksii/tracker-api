generator client {
  provider          = "prisma-client"
  output            = "../generated/prisma"
  moduleFormat      = "cjs"
  importFileExtension = ""
}

datasource db {
  provider = "postgresql"
}

enum UserRole {
  USER
  ADMIN
  SUPER_ADMIN
}

enum TransactionType {
  EXPENSE
  INCOME
}

enum CountryCode {
  AD
  AE
  AF
  AG
  AI
  AL
  AM
  AO
  AQ
  AR
  AS
  AT
  AU
  AW
  AX
  AZ
  BA
  BB
  BD
  BE
  BF
  BG
  BH
  BI
  BJ
  BL
  BM
  BN
  BO
  BQ
  BR
  BS
  BT
  BV
  BW
  BY
  BZ
  CA
  CC
  CD
  CF
  CG
  CH
  CI
  CK
  CL
  CM
  CN
  CO
  CR
  CU
  CV
  CW
  CX
  CY
  CZ
  DE
  DJ
  DK
  DM
  DO
  DZ
  EC
  EE
  EG
  EH
  ER
  ES
  ET
  FI
  FJ
  FK
  FM
  FO
  FR
  GA
  GB
  GD
  GE
  GF
  GG
  GH
  GI
  GL
  GM
  GN
  GP
  GQ
  GR
  GS
  GT
  GU
  GW
  GY
  HK
  HM
  HN
  HR
  HT
  HU
  ID
  IE
  IL
  IM
  IN
  IO
  IQ
  IR
  IS
  IT
  JE
  JM
  JO
  JP
  KE
  KG
  KH
  KI
  KM
  KN
  KP
  KR
  KW
  KY
  KZ
  LA
  LB
  LC
  LI
  LK
  LR
  LS
  LT
  LU
  LV
  LY
  MA
  MC
  MD
  ME
  MF
  MG
  MH
  MK
  ML
  MM
  MN
  MO
  MP
  MQ
  MR
  MS
  MT
  MU
  MV
  MW
  MX
  MY
  MZ
  NA
  NC
  NE
  NF
  NG
  NI
  NL
  NO
  NP
  NR
  NU
  NZ
  OM
  PA
  PE
  PF
  PG
  PH
  PK
  PL
  PM
  PN
  PR
  PS
  PT
  PW
  PY
  QA
  RE
  RO
  RS
  RU
  RW
  SA
  SB
  SC
  SD
  SE
  SG
  SH
  SI
  SJ
  SK
  SL
  SM
  SN
  SO
  SR
  SS
  ST
  SV
  SX
  SY
  SZ
  TC
  TD
  TF
  TG
  TH
  TJ
  TK
  TL
  TM
  TN
  TO
  TR
  TT
  TV
  TW
  TZ
  UA
  UG
  UM
  US
  UY
  UZ
  VA
  VC
  VE
  VG
  VI
  VN
  VU
  WF
  WS
  YE
  YT
  ZA
  ZM
  ZW
}

enum CurrencyCode {
  AED
  AFN
  ALL
  AMD
  ANG
  AOA
  ARS
  AUD
  AWG
  AZN
  BAM
  BBD
  BDT
  BGN
  BHD
  BIF
  BMD
  BND
  BOB
  BRL
  BSD
  BTN
  BWP
  BYN
  BZD
  CAD
  CDF
  CHF
  CLP
  CNY
  COP
  CRC
  CUP
  CVE
  CZK
  DJF
  DKK
  DOP
  DZD
  EGP
  ERN
  ETB
  EUR
  FJD
  FKP
  GBP
  GEL
  GHS
  GIP
  GMD
  GNF
  GTQ
  GYD
  HKD
  HNL
  HRK
  HTG
  HUF
  IDR
  ILS
  INR
  IQD
  IRR
  ISK
  JMD
  JOD
  JPY
  KES
  KGS
  KHR
  KMF
  KPW
  KRW
  KWD
  KYD
  KZT
  LAK
  LBP
  LKR
  LRD
  LSL
  LYD
  MAD
  MDL
  MGA
  MKD
  MMK
  MNT
  MOP
  MRU
  MUR
  MVR
  MWK
  MXN
  MYR
  MZN
  NAD
  NGN
  NIO
  NOK
  NPR
  NZD
  OMR
  PAB
  PEN
  PGK
  PHP
  PKR
  PLN
  PYG
  QAR
  RON
  RSD
  RUB
  RWF
  SAR
  SBD
  SCR
  SDG
  SEK
  SGD
  SHP
  SLE
  SLL
  SOS
  SRD
  SSP
  STN
  SYP
  SZL
  THB
  TJS
  TMT
  TND
  TOP
  TRY
  TTD
  TWD
  TZS
  UAH
  UGX
  USD
  UYU
  UZS
  VES
  VND
  VUV
  WST
  XAF
  XCD
  XDR
  XOF
  XPF
  YER
  ZAR
  ZMW
  ZWL
}

model User {
  id                              String         @id @default(uuid()) @db.Uuid
  email                           String         @unique
  passwordHash                    String
  emailVerified                   Boolean        @default(false)
  emailVerificationToken          String?
  emailVerificationTokenExpiresAt DateTime?
  countryCode                     CountryCode?
  baseCurrencyCode                CurrencyCode?
  ipAddress                       String?
  userAgent                       String?
  role                            UserRole       @default(USER)
  createdAt                       DateTime       @default(now())
  updatedAt                       DateTime       @updatedAt
  deletedAt                       DateTime?
  refreshTokens                   RefreshToken[]
  categories                      Category[]
  transactions                    Transaction[]

  @@index([email])
}

model RefreshToken {
  id                String        @id @default(uuid()) @db.Uuid
  userId            String        @db.Uuid
  token             String        @unique
  deviceInfo        String?
  ipAddress         String?
  userAgent         String?
  expiresAt         DateTime
  replacedByTokenId String?       @unique @db.Uuid
  replacedByToken   RefreshToken? @relation("ReplacedBy", fields: [replacedByTokenId], references: [id])
  replacedToken     RefreshToken? @relation("ReplacedBy")
  revokedAt         DateTime?
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
  user              User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([token])
  @@index([userId])
}

model Category {
  id               String          @id @default(uuid()) @db.Uuid
  userId           String          @db.Uuid
  name             String
  type             TransactionType
  parentCategoryId String?         @db.Uuid
  parentCategory   Category?       @relation("CategoryHierarchy", fields: [parentCategoryId], references: [id], onDelete: Cascade)
  subcategories    Category[]      @relation("CategoryHierarchy")
  createdAt        DateTime        @default(now())
  updatedAt        DateTime        @updatedAt
  deletedAt        DateTime?
  user             User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  transactions     Transaction[]

  @@unique([userId, name, type, parentCategoryId])
  @@index([userId])
  @@index([parentCategoryId])
  @@index([type])
}

model Transaction {
  id           String          @id @default(uuid()) @db.Uuid
  userId       String          @db.Uuid
  categoryId   String          @db.Uuid
  type         TransactionType
  amount       Decimal         @db.Decimal(19, 4)
  currencyCode CurrencyCode
  date         DateTime
  description  String?
  createdAt    DateTime        @default(now())
  updatedAt    DateTime        @updatedAt
  deletedAt    DateTime?
  user         User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  category     Category        @relation(fields: [categoryId], references: [id], onDelete: Restrict)

  @@index([userId])
  @@index([categoryId])
  @@index([date])
  @@index([type])
  @@index([currencyCode])
}
